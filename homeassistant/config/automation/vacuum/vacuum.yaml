---

- alias: "Vacuum - Start cleaning when away"
  id: 0a5f46de-effa-4b82-a4f3-b0508dbd4095
  trigger:
    platform: state
    entity_id: group.person
    to: 'not_home'
  condition:
    - condition: time
      after: '07:00:00'
      before: '20:00:00'
    - "{{ is_state('input_boolean.cleaned_today', 'off') }}"
    - "{{ is_state('input_boolean.disable_auto_clean', 'off') }}"
    - "{{ is_state('input_boolean.guest_mode', 'off') }}"
  action:
    - service: vacuum.start
      data:
        entity_id: vacuum.roborock_s7
    - service: notify.family
      data:
        message: "Vacuum has started the daily cleaning"
        title: "Cleaning started"
        data:
          image: 'https://i.kym-cdn.com/photos/images/newsfeed/001/636/536/df1.jpg'
          actions:
            - action: CANCEL
              title: Cancel cleaning

- alias: "Vacuum - Cancel on response"
  id: d6b1aa9c-fcc3-427a-bfa1-372f76612011
  trigger:
    platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: 'CANCEL'
  action:
    - service: vacuum.stop
      data:
        entity_id: vacuum.roborock_s7
    - service: notify.family
      data:
        title: "Cleaning stopped"
        message: "Cleaning stopped"

- alias: "Vacuum - Return to dock if got stuck"
  id: c70477c9-66c0-43db-9036-570aa6bfcb09
  trigger:
    platform: state
    entity_id: vacuum.roborock_s7
    from: 'cleaning'
    to: 'error'
    for:
      minutes: 8
  action:
    - service: vacuum.return_to_base
      data:
        entity_id: vacuum.roborock_s7
    - service: notify.family
      data:
        title: "Returning to Dock"
        message: >-
          "{{ states('sensor.roborock_s7_vacuum_error') }} and you left me in the dark, So I am returning home."
        data:
          image: "https://memegenerator.net/img/images/400x/8230737.jpg"
